<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Astro-Games</title>
<link rel="stylesheet" href="site.css" />
<meta name="description" content="Play small focused indie web games instantly. Minute sessions. Zero friction." />
<script src="firebase/config.js" defer></script>
<script type="module" src="firebase/init.js"></script>
</head>
<body>
<header>
  <div class="logo">Astro-Games</div>
  <nav>
    <a href="#games">Games</a>
    <a href="#about">About</a>
    <a href="#tech">Tech</a>
  </nav>
  <div id="authBox" style="margin-left:auto;display:flex;align-items:center;gap:14px;">
    <div id="statusDot" title="Offline" style="width:10px;height:10px;border-radius:50%;background:#555;box-shadow:0 0 4px rgba(0,0,0,.6);"></div>
    <button id="btnGuest" style="background:#203042;border:1px solid #2b3c4b;color:#8dd4ff;font:500 12px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">Guest</button>
    <button id="btnSignIn" style="background:#203042;border:1px solid #2b3c4b;color:#8dd4ff;font:500 12px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">Google</button>
    <div id="userBadge" style="display:none;align-items:center;gap:8px;position:relative;">
      <img id="userPic" src="" alt="" style="width:30px;height:30px;border-radius:50%;object-fit:cover;border:1px solid #2b3c4b;cursor:pointer;" />
      <span id="userName" style="font:500 12px system-ui;color:#b8c7d6;max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;"></span>
      <span id="userStreak" style="font:600 11px system-ui;color:#ffd66b;"></span>
      <div id="profilePanel" style="display:none;position:absolute;top:42px;right:0;background:#14202b;border:1px solid #203042;border-radius:10px;padding:12px 14px;min-width:220px;z-index:40;box-shadow:0 8px 24px -10px rgba(0,0,0,.7);">
        <div style="font:600 13px system-ui;color:#fff;margin-bottom:8px;">Profile</div>
        <label style="display:block;font:500 11px system-ui;color:#8aa2b5;margin-bottom:4px;">Display Name</label>
        <input id="inpDisplayName" type="text" maxlength="32" style="width:100%;padding:6px 8px;border-radius:6px;border:1px solid #2b3c4b;background:#0f1821;color:#cfe;font:12px system-ui;margin-bottom:8px;" />
        <button id="btnSaveName" style="background:#256dff;border:1px solid #1d56c8;color:#fff;font:500 12px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;width:100%;margin-bottom:8px;">Save</button>
        <button id="btnUpgrade" style="display:none;background:#284052;border:1px solid #34586a;color:#8dd4ff;font:500 12px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;width:100%;margin-bottom:8px;">Link Google</button>
        <button id="btnSignOut" title="Sign Out" style="background:#35222a;border:1px solid #4c2c38;color:#ff9faf;font:500 12px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;width:100%;">Sign Out</button>
      </div>
    </div>
  </div>
</header>
<main>
  <section class="hero">
    <div class="heroText">
  <h1>Snackable <br />Arcadeâ€‘Scale Games</h1>
      <p>Quick to learn, deep to master. A growing collection of handcrafted, minute-long indie experiences you can play directly in your browserâ€”no installs, no tracking, pure gameplay.</p>
      <div class="badgeBar">
        <div class="badge">âš¡ Fast Loads</div>
        <div class="badge">ðŸŽ® Gamepad Ready</div>
        <div class="badge">ðŸŒˆ Accessibility Options</div>
        <div class="badge">ðŸ“… Daily Modes</div>
      </div>
    </div>
    <div class="heroArt" id="heroCanvasWrap">
      <canvas id="heroCanvas" width="360" height="260" style="width:100%;height:100%;image-rendering:pixelated;"></canvas>
    </div>
  </section>
  <section id="games">
    <h2 style="margin:46px 0 6px;font:600 22px system-ui;color:#fff">Launch Titles</h2>
    <p style="margin:0 0 10px;font-size:14px;color:#9cb3c9;max-width:760px">More games are coming. Each one is a focused prototype exploring a single distilled mechanic loop. Iterate with usâ€”feedback welcome.</p>
    <div class="grid">
      <div class="card">
        <h3>Minute Mage</h3>
        <p>Dodge swarming drones, chain perfect dashes, hoover orbs to push your multiplier. Daily seeded runs & lightweight relic drafts add variety.</p>
        <div>
          <span class="tag">Action</span>
          <span class="tag">1â€‘Minute Runs</span>
          <span class="tag">Procedural</span>
        </div>
  <button class="playBtn" data-game="minute-mage">Play â–¶</button>
      </div>
      <div class="card" style="opacity:.55;filter:grayscale(.4);">
        <h3>Coming Soon</h3>
        <p>New experimental mini game in active prototyping. Stay tuned.</p>
        <div>
          <span class="tag">TBD</span>
          <span class="tag">Prototype</span>
        </div>
        <div class="playBtn" style="pointer-events:none;background:#203042;color:#4d5d6a;">In Dev</div>
      </div>
    </div>
  </section>
  <section id="about" style="margin-top:70px;max-width:880px;">
    <h2 style="font:600 22px system-ui;margin:0 0 10px;color:#fff;">About</h2>
    <p style="font-size:14px;line-height:1.55;color:#9cb3c9;margin:0 0 14px;">This site is an evolving lab for rapidâ€‘iteration arcade concepts. Games share a small engine layer (input, particles, audio SFX synthesizer, procedural sprites) so we can prototype new ideas fast. Everything runs clientâ€‘side.</p>
    <p style="font-size:14px;line-height:1.55;color:#9cb3c9;margin:0 0 14px;" id="tech">Tech stack: Vanilla JS, Canvas 2D, procedural art generation, tiny WebAudio synth, deterministic daily seeds (xorshift). No frameworks, minimal bundle size.</p>
  </section>
</main>
<footer>
  Â© <span id="year"></span> Indie Mini Arcade Â· Feedback welcome Â· <a href="#" style="color:#8dd4ff;">Contact</a>
</footer>
<div id="gameLauncher" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.75);backdrop-filter:blur(4px);z-index:500;">
  <div id="launcherWindow" style="background:#0d141c;border:1px solid #203042;border-radius:14px;box-shadow:0 20px 50px -20px rgba(0,0,0,.7);width:980px;max-width:95vw;display:flex;flex-direction:column;overflow:hidden;">
    <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;background:#14202b;border-bottom:1px solid #203042;">
      <strong id="launcherTitle" style="font:600 14px system-ui;color:#fff;">Game</strong>
      <span id="launcherStatus" style="font-size:11px;color:#7fd;">Loading...</span>
      <div style="margin-left:auto;display:flex;gap:6px;">
        <button id="btnSmall" title="Window Size" style="background:#203042;border:1px solid #2b3c4b;color:#9cb3c9;font:500 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">S</button>
        <button id="btnMedium" style="background:#203042;border:1px solid #2b3c4b;color:#9cb3c9;font:500 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">M</button>
        <button id="btnLarge" style="background:#203042;border:1px solid #2b3c4b;color:#9cb3c9;font:500 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">L</button>
        <button id="btnFullscreen" title="Fullscreen" style="background:#203042;border:1px solid #2b3c4b;color:#9cb3c9;font:500 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">â›¶</button>
        <button id="btnOpenTab" title="Open In New Tab" style="background:#203042;border:1px solid #2b3c4b;color:#9cb3c9;font:500 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">â†—</button>
        <button id="btnClose" title="Close" style="background:#35222a;border:1px solid #4c2c38;color:#ff8f9f;font:600 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">âœ•</button>
      </div>
    </div>
    <div style="position:relative;background:#0b0c11;">
      <iframe id="gameFrame" src="" loading="lazy" allowfullscreen style="display:block;border:0;width:960px;height:560px;background:#0b0c11;"></iframe>
      <div id="loadingOverlay" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font:500 13px system-ui;color:#9cb3c9;background:rgba(10,15,20,0.75);">Loadingâ€¦</div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;padding:10px 14px;background:#14202b;border-top:1px solid #203042;">
      <button class="quickGame" data-game="minute-mage" style="background:#203042;border:1px solid #2b3c4b;color:#8dd4ff;font:500 11px system-ui;padding:6px 10px;border-radius:6px;cursor:pointer;">Minute Mage</button>
      <button disabled style="background:#1a2430;border:1px solid #283544;color:#4c5d6a;font:500 11px system-ui;padding:6px 10px;border-radius:6px;">Coming Soon</button>
      <span style="margin-left:auto;font-size:11px;color:#5f7386;">Esc: Close Â· F: Fullscreen</span>
    </div>
  </div>
</div>
<script>
(function(){
  const can=document.getElementById('heroCanvas'); if(!can) return; const ctx=can.getContext('2d');
  const drones=[]; const N=14; let t0=performance.now();
  function rand(a,b){return a+Math.random()*(b-a);} 
  function makeFallback(){const c=document.createElement('canvas');c.width=c.height=24;const g=c.getContext('2d');g.fillStyle='#2e3e4a';g.fillRect(8,8,8,8);g.fillStyle='#49c2ff';g.fillRect(11,11,2,2);return c;}
  for(let i=0;i<N;i++){drones.push({x:rand(20,340),y:rand(20,240),r:rand(16,28),a:Math.random()*Math.PI*2,s:rand(0.5,1.4)});} 
  function loop(){const now=performance.now();const dt=(now-t0)/1000;t0=now;ctx.clearRect(0,0,can.width,can.height);ctx.fillStyle='#0d151d';ctx.fillRect(0,0,can.width,can.height);drones.forEach(d=>{d.x+=Math.sin(now/1000+d.a)*0.15;d.y+=Math.cos(now/1100+d.a)*0.15;const t=now/1000*d.s;let drew=false;if(window.DroneFactory){const spr=DroneFactory.get('enemy_basic','#49c2ff',t);if(spr){ctx.imageSmoothingEnabled=false;ctx.globalAlpha=0.5;ctx.drawImage(spr.canvas,d.x-spr.size/2,d.y-spr.size/2,spr.size,spr.size);ctx.globalAlpha=1;drew=true;}}if(!drew){const fb=makeFallback();ctx.globalAlpha=0.35;ctx.drawImage(fb,d.x-fb.width/2,d.y-fb.height/2);ctx.globalAlpha=1;} });requestAnimationFrame(loop);} requestAnimationFrame(loop);})();
  document.getElementById('year').textContent=new Date().getFullYear();
  // Launcher logic
  const launcher = document.getElementById('gameLauncher');
  const frame = document.getElementById('gameFrame');
  const loadingOverlay = document.getElementById('loadingOverlay');
  const titleEl = document.getElementById('launcherTitle');
  const statusEl = document.getElementById('launcherStatus');
  function openGame(id){
    const meta = { 'minute-mage': { title:'Minute Mage', path:'games/minute-mage/index.html' } }[id];
    if(!meta) return; launcher.style.display='flex'; loadingOverlay.style.display='flex'; statusEl.textContent='Loading...';
    document.body.style.overflow='hidden';
  // Set src then focus once load completes
  frame.src = meta.path; titleEl.textContent = meta.title; history.pushState({modal:true},'', '#play-'+id);
  // If already loaded instantly (cache), attempt focus
  try { frame.setAttribute('tabindex','0'); frame.focus({preventScroll:true}); } catch(e){}
  }
  function closeLauncher(){ launcher.style.display='none'; frame.src=''; if(location.hash.startsWith('#play-')) history.pushState({},'', location.pathname); }
  const _closeOrig = closeLauncher;
  closeLauncher = function(){ _closeOrig(); document.body.style.overflow=''; };
  document.querySelectorAll('.playBtn[data-game]').forEach(btn=> btn.addEventListener('click',()=> openGame(btn.dataset.game)) );
  document.querySelectorAll('.quickGame[data-game]').forEach(btn=> btn.addEventListener('click',()=> openGame(btn.dataset.game)) );
  document.getElementById('btnClose').onclick = closeLauncher;
  document.getElementById('btnOpenTab').onclick = ()=> { if(frame.src) window.open(frame.src,'_blank'); };
  function setSize(w,h){ frame.style.width=w+'px'; frame.style.height=h+'px'; }
  document.getElementById('btnSmall').onclick = ()=> setSize(640,360);
  document.getElementById('btnMedium').onclick = ()=> setSize(800,450);
  document.getElementById('btnLarge').onclick = ()=> setSize(960,540);
  document.getElementById('btnFullscreen').onclick = ()=> { if(frame.requestFullscreen) frame.requestFullscreen(); };
  frame.addEventListener('load', ()=> { loadingOverlay.style.display='none'; statusEl.textContent=''; try { frame.focus({preventScroll:true}); } catch(e){} });
  window.addEventListener('keydown', e=> { if(e.key==='Escape' && launcher.style.display==='flex'){ closeLauncher(); } if(e.key.toLowerCase()==='f' && launcher.style.display==='flex'){ document.getElementById('btnFullscreen').click(); }});
  // Suppress page scroll while modal active for game control keys
  window.addEventListener('keydown', e=>{
    if(launcher.style.display==='flex'){
      const blockKeys=[' ','ArrowUp','ArrowDown','ArrowLeft','ArrowRight'];
      if(blockKeys.includes(e.key)) e.preventDefault();
  // Ensure iframe has focus so game receives input
  if(document.activeElement !== frame){ try { frame.focus({preventScroll:true}); } catch(err){} }
    }
  }, { passive:false });
  // Deep link hash (#play-minute-mage)
  if(location.hash.startsWith('#play-')){ openGame(location.hash.replace('#play-','')); }
  // Auth UI wiring
  const btnIn = document.getElementById('btnSignIn');
  const btnGuest = document.getElementById('btnGuest');
  const btnOut = document.getElementById('btnSignOut');
  const userBadge = document.getElementById('userBadge');
  const userName = document.getElementById('userName');
  const userPic = document.getElementById('userPic');
  const userStreak = document.getElementById('userStreak');
  const statusDot = document.getElementById('statusDot');
  const profilePanel = document.getElementById('profilePanel');
  const inpDisplayName = document.getElementById('inpDisplayName');
  const btnSaveName = document.getElementById('btnSaveName');
  const btnUpgrade = document.getElementById('btnUpgrade');
  function setStatus(color,title){ if(statusDot){ statusDot.style.background=color; statusDot.title=title; } }
  window.addEventListener('online', ()=> setStatus('#2ecc71','Online')); window.addEventListener('offline', ()=> setStatus('#c0392b','Offline'));
  setStatus(navigator.onLine? '#2ecc71':'#c0392b', navigator.onLine? 'Online':'Offline');
  if(window.AstroBackend){
    btnIn?.addEventListener('click', async()=>{ try { await AstroBackend.signInWithGoogle(); } catch(e){ console.warn(e);} });
    btnGuest?.addEventListener('click', async()=>{ try { await AstroBackend.signInGuest(); } catch(e){ console.warn(e);} });
    btnOut?.addEventListener('click', ()=> AstroBackend.signOutUser());
    AstroBackend.onUserChanged(async(u)=>{
      if(u){
        btnIn.style.display='none'; userBadge.style.display='flex';
        btnGuest.style.display='none';
        userPic.src = u.photoURL || 'https://dummyimage.com/64x64/203042/ffffff&text=U';
        userName.textContent = u.displayName || 'Player';
        const doc = await AstroBackend.getUserDoc(u.uid); if(doc){ userStreak.textContent = doc.streakCount>0 ? `ðŸ”¥${doc.streakCount}` : ''; }
        inpDisplayName.value = u.displayName || '';
        // Show upgrade option if anonymous
        if(u.isAnonymous){ btnUpgrade.style.display='inline-block'; } else { btnUpgrade.style.display='none'; }
      } else {
        btnIn.style.display='inline-block'; btnGuest.style.display='inline-block'; userBadge.style.display='none'; userStreak.textContent='';
      }
    });
    // Update streak once per day after login
    AstroBackend.onUserChanged(async(u)=>{ if(u){ try { await AstroBackend.updateStreak(u.uid, new Date().toISOString().slice(0,10)); const doc = await AstroBackend.getUserDoc(u.uid); if(doc){ userStreak.textContent = doc.streakCount>0 ? `ðŸ”¥${doc.streakCount}` : ''; } } catch(e){} } });
    btnSaveName?.addEventListener('click', async()=>{ const v = inpDisplayName.value.trim(); if(!v) return; const name = await AstroBackend.updateDisplayName(v); userName.textContent = name; });
    btnUpgrade?.addEventListener('click', async()=>{ try { await AstroBackend.upgradeGuestToGoogle(); } catch(e){ console.warn(e);} });
    function toggleProfilePanel(){ profilePanel.style.display = profilePanel.style.display==='none' || !profilePanel.style.display ? 'block':'none'; }
    userPic?.addEventListener('click', toggleProfilePanel);
    userName?.addEventListener('click', toggleProfilePanel);
    document.addEventListener('click', (e)=>{ if(profilePanel.style.display==='block' && !profilePanel.contains(e.target) && !userBadge.contains(e.target)){ profilePanel.style.display='none'; } }, true);
  }
</script>
</body>
</html>
